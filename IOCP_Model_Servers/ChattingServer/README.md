# Chatting Server(Version 1)

- SendThread가 있는 라이브러리를 사용.
- 특징
  1. 싱글쓰레드 컨텐츠
  2. 락프리큐를 이용한 쓰레드간 메시지 전달
- 기능
  1. 로그인
  2. 섹터 이동
  3. 채팅 요청
- 한계
  1. 싱글 스레드이기 때문에 모든 워커쓰레드들의 싱글 쓰레드로의 JobEnqueue 과정에서의 병목 발생.
  2. 사실상 워커쓰레드들이 IO완료 처리 이외에 아무 작업을 하지 않기 때문에 cpu 사용율이 아주 낮음(Worker지만 거의 일을 하지 않고 있음)

# Chatting Server(Version 2)

- SendThread 대신 WorkerThread가 직접 Send에 개입하는 형태로 구현
- 특징
  1. 컨텐츠에 접근하는 쓰레드가 멀티쓰레드
  2. 락을 이용한 공유자원 획득
- 기능
  1. 로그인
  2. 섹터이동
  3. 채팅요청
- 구현시 주의사항
  1. 동기화 객체를 사용할 때 락의 순서를 맞추지 않으면 데드락에 빠지게됨
  1. 섹터 이동시 두개의 섹터 락이 동시에 확보되지 않으면 작업을 진행하지 않음(TryLock을 사용, 하나 성공후 실패시 Unlock + YieldProcessor를 통해 다른 쓰레드가 해제할 수 있도록 유도함)
  1. 채팅 요청시 주변 9개의 섹터에 락을 걸게되고 모든 락이 확보되지 않으면 작업이 진행되지않음(Lock거는 규칙을 정해 순서가 뒤바뀐 락이 걸리지 않게 해서 해결)
- Version1 에서의 개선점
  1. 잡큐잉 방식이 아니기 때문에 동시에 두 작업 이상 처리가능
  2. 섹터는 50*50 크기로 확률상 3% 이내의 확률로 경합 발생(거의 경합이 발생하지 않으므로 실질적으로 거의 모든 경우 워커 쓰레드 전체가 동시에 작업을 수행함)
